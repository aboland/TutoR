---
title: "Week2 Food Consumption"
author: "Aidan Boland"
date: "4/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(dplyr)
library(ggplot2)
library(knitr)
```

## Data

```{r load data}
food_consumption <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-18/food_consumption.csv')
```


```{r}
food_consumption[1:15,] %>%
  kable()
```



```{r}
food_consumption %>%
  ggplot(aes(consumption, co2_emmission)) +
  geom_point()

food_consumption %>%
  ggplot(aes(consumption, co2_emmission, colour = country)) +
  geom_point()

food_consumption %>%
  ggplot(aes(consumption, co2_emmission, colour = country)) +
  geom_point() +
  theme(legend.position = "none")
```


```{r}
food_consumption %>%
  ggplot(aes(consumption, co2_emmission, colour = food_category)) +
  geom_point()


food_consumption %>%
  ggplot(aes(consumption, co2_emmission, colour = food_category)) +
  geom_point() +
  labs(title = "Co2 emmission vs Consumption",
       y = "kg CO2/person/year", x = "kg/person/year")

food_consumption %>%
  ggplot(aes(consumption, co2_emmission, colour = food_category)) +
  geom_point() +
  labs(title = expression('CO'[2]*" Emmission vs Consumption (per person per year)"),
       y = expression('kg CO'[2]*"/person/year"), x = "kg/person/year",
       colour = "Food Type")
```

#### From Website

'The study analyses data from the Food and Agriculture Organization of the United Nations (FAO) to determine the quantity of produce supplied for consumption of 11 food types for all countries researched. Using CO2 emissions data, the carbon footprint per capita is then calculated for each food type.'

Quantity was recoreded, and carbon footprint calculated using this.


## Look at Consumption Only

```{r}
food_consumption %>%
  ggplot(aes(x = food_category, y = consumption, colour = country)) +
  geom_point() 

# Remove legend
food_consumption %>%
  ggplot(aes(x = food_category, y = consumption, colour = country)) +
  geom_point() +
  theme(legend.position = "none")

# Flip plot
food_consumption %>%
  ggplot(aes(x = food_category, y = consumption, colour = country)) +
  geom_point() +
  theme(legend.position = "none") +
  coord_flip()

# alternative
food_consumption %>%
  ggplot(aes(y = food_category, x = consumption, colour = country)) +
  geom_point() +
  theme(legend.position = "none")

#jitter
food_consumption %>%
  ggplot(aes(y = food_category, x = consumption, colour = country)) +
  geom_jitter() +
  theme(legend.position = "none")
```



```{r}
food_consumption %>%
  ggplot(aes(y = country, x = consumption, colour = food_category)) +
  geom_jitter()
```

## Summary Stats - Consumption by country

```{r}
food_consumption %>%
  group_by(country) %>%
  summarise(average_consumption = mean(consumption)) %>%
  arrange(desc(average_consumption)) %>%
  head(15) %>% kable()
```



```{r}
food_consumption %>%
  group_by(country) %>%
  summarise(average_consumption = mean(consumption)) %>%
  arrange(average_consumption) %>%
  head(15) %>% kable()
```


### Ireland

```{r}
food_consumption %>%
  filter(country == "Ireland") %>%
  arrange(desc(consumption)) %>%
  kable()
```


### By Food Type

```{r}
food_consumption %>%
  filter(food_category == "Pork") %>%
  arrange(desc(consumption)) %>%
  head(10) %>% kable()

food_consumption %>%
  filter(food_category == "Pork") %>%
  arrange(consumption) %>%
  head(10) %>% kable()
```


```{r}
food_consumption %>%
  filter(food_category == "Milk - inc. cheese") %>%
  arrange(desc(consumption)) %>%
  head(10) %>% kable()

food_consumption %>%
  filter(food_category == "Milk - inc. cheese") %>%
  arrange(consumption) %>%
  head(10) %>% kable()
```


# Map

```{r}
library(maps)

world <- map_data("world")

ggplot() + 
      geom_polygon(data = world, 
                   aes(x = long, y = lat, group = group), fill = NA, color = "black") 



food_consumption %>%
  filter(food_category == "Pork") %>%
  inner_join(world, by = c("country" = "region")) -> food_consumption_map

ggplot() + 
      geom_polygon(data = world, 
                   aes(x = long, y = lat, group = group), fill = NA, color = "black") + 
      geom_polygon(data = food_consumption_map, 
                 aes(x = long, y = lat, group = group, fill = consumption))


library(scales)

ggplot() + 
      geom_polygon(data = world, 
                   aes(x = long, y = lat, group = group), fill = NA, color = "black") + 
      geom_polygon(data = food_consumption_map, 
                 aes(x = long, y = lat, group = group, fill = consumption)) +
  scale_fill_distiller(palette = "Spectral", labels = number_format(suffix = " kg/person/year"))

ggplot() + 
      geom_polygon(data = world, 
                   aes(x = long, y = lat, group = group), fill = NA, color = "black") + 
      geom_polygon(data = food_consumption_map, 
                 aes(x = long, y = lat, group = group, fill = consumption)) +
  scale_fill_distiller(palette = "Spectral", labels = number_format(suffix = " kg/person/year")) +
  coord_fixed(1.3)


ggplot() + 
      geom_polygon(data = world, 
                   aes(x = long, y = lat, group = group), fill = NA, color = "black") + 
      geom_polygon(data = food_consumption_map, 
                 aes(x = long, y = lat, group = group, fill = consumption)) +
  scale_fill_distiller(palette = "Spectral", labels = number_format(suffix = " kg/person/year")) +
  coord_fixed(1.3) +
  theme_void() +
    theme(plot.margin = unit(c(0,0.1,0,0), "cm")) +
  labs(fill = "Pork Consumption")
```

```{r}
# unique(food_consumption$food_category)

food_type <- "Milk - inc. cheese"

food_consumption %>%
  filter(food_category == food_type) %>%
  inner_join(world, by = c("country" = "region")) -> food_consumption_map


ggplot() + 
      geom_polygon(data = world, 
                   aes(x = long, y = lat, group = group), fill = NA, color = "black") + 
      geom_polygon(data = food_consumption_map, 
                 aes(x = long, y = lat, group = group, fill = consumption)) +
  scale_fill_distiller(palette = "Spectral", labels = number_format(suffix = " kg/person/year")) +
  coord_fixed(1.3) +
  theme_void() +
    theme(plot.margin = unit(c(0,0.1,0,0), "cm")) +
  labs(fill = paste0(food_type, " Consumption"))
```



# Total Footprint


```{r}
food_consumption %>%
  group_by(country) %>%
  summarise(total = sum(co2_emmission)) -> total_emissions

total_emissions %>%
  arrange(desc(total)) %>%
  head(10) %>% kable
```



```{r}
total_emissions %>%
  inner_join(world, by = c("country" = "region")) -> total_consumption_map

ggplot() + 
      geom_polygon(data = world, 
                   aes(x = long, y = lat, group = group), fill = NA, color = "black") + 
      geom_polygon(data = total_consumption_map, 
                 aes(x = long, y = lat, group = group, fill = total)) +
  scale_fill_distiller(palette = "Spectral", labels = comma_format(suffix = " CO2 kg/person/year")) +
  coord_fixed(1.3) +
  theme_void() +
    theme(plot.margin = unit(c(0,0.1,0,0), "cm")) +
  labs(fill = "Total Emissions")
```









